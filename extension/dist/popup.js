(()=>{const e="http://localhost:3000";let n={step:1,repoOwner:"",repoName:"",backgroundKnowledge:null,contributionAnalysis:null,username:"",portfolioHtml:"",progress:0};async function t(n,t){try{console.log(`API í˜¸ì¶œ: ${n}`,t);const o=await fetch(`${e}/${n}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)});console.log("ì‘ë‹µ ìƒíƒœ:",o.status,o.statusText);const r=o.headers.get("content-type");if(console.log("ì‘ë‹µ ì½˜í…ì¸  íƒ€ì…:",r),!r||!r.includes("application/json")){const e=await o.text();throw console.error("ì‘ë‹µì´ JSONì´ ì•„ë‹˜. ì‘ë‹µ (ì²˜ìŒ 100ì):",e.substring(0,100)),new Error("ì„œë²„ê°€ ìœ íš¨í•œ JSONì„ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.")}if(!o.ok)try{const e=await o.json();throw new Error(e.details||e.message||`ì„œë²„ ì˜¤ë¥˜: ${o.status}`)}catch(e){throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜ (${o.status}): JSON íŒŒì‹± ì‹¤íŒ¨`)}try{return await o.json()}catch(e){throw console.error("JSON íŒŒì‹± ì˜¤ë¥˜:",e),new Error("ì„œë²„ ì‘ë‹µ ë°ì´í„°ë¥¼ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}}catch(e){throw console.error("API í˜¸ì¶œ ì˜¤ë¥˜:",e),e}}async function o(){try{const n=await fetch(`${e}/ping`,{method:"GET",headers:{Accept:"application/json"}});if(!n.ok)return console.error("ì„œë²„ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:",n.status),!1;try{const e=await n.json();return console.log("ì„œë²„ ìƒíƒœ í™•ì¸ ì„±ê³µ:",e),!0}catch(e){return console.error("ì„œë²„ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨:",e),!1}}catch(e){return console.error("ì„œë²„ ì—°ê²° ì‹¤íŒ¨:",e),!1}}document.addEventListener("DOMContentLoaded",(async function(){const e=document.getElementById("status"),r=document.getElementById("loader"),a=document.getElementById("result"),s=document.getElementById("resultActions"),i=document.querySelector(".progress-bar"),c=document.getElementById("progress-text"),l=document.getElementById("analyzeRepoBtn"),d=document.getElementById("analyzeContributionsBtn"),u=document.getElementById("generatePortfolioBtn"),p=document.getElementById("copyHtmlBtn"),m=document.getElementById("downloadHtmlBtn"),g=document.getElementById("previewBtn"),y=document.getElementById("step1"),b=document.getElementById("step2"),h=document.getElementById("step3"),w=document.getElementById("step1-status"),f=document.getElementById("step2-status"),E=document.getElementById("step3-status"),v=document.getElementById("repoUrl"),$=document.getElementById("username"),k=document.createElement("button");function B(n,t="primary"){e.textContent=n,e.className=`alert alert-${t}`}function I(e){i&&c&&(n.progress=e,i.style.width=`${e}%`,c.textContent=`${e}%`)}function L(e,n,t){const o=[w,f,E][e-1];if(o){switch(n){case"waiting":o.textContent="ëŒ€ê¸° ì¤‘",o.className="badge bg-secondary";break;case"in-progress":o.textContent="ì§„í–‰ ì¤‘",o.className="badge bg-primary";break;case"completed":o.textContent="ì™„ë£Œ",o.className="badge bg-success";break;case"error":o.textContent="ì˜¤ë¥˜",o.className="badge bg-danger"}t&&B(t,"error"===n?"danger":"info")}}function x(e){n.step=e,y&&b&&h&&[y,b,h].forEach(((n,t)=>{t+1===e?n.classList.add("step-active"):n.classList.remove("step-active")}))}k.textContent="ì„œë²„ ì—°ê²° í™•ì¸",k.className="btn btn-sm btn-outline-secondary mt-2 mb-2",k.addEventListener("click",(async function(){B("ì„œë²„ ì—°ê²° í™•ì¸ ì¤‘...","info"),await o()?B("ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.","success"):B("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.","danger")})),e&&r&&a?(e.parentNode&&e.parentNode.insertBefore(k,e.nextSibling),await o()||B("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.","warning"),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){const t=e[0].url.match(/^https:\/\/github\.com\/([^\/]+)\/([^\/]+)(?:\/.*)?$/);t&&v?(n.repoOwner=t[1],n.repoName=t[2],v.value=`https://github.com/${n.repoOwner}/${n.repoName}`,B("GitHub ë ˆí¬ì§€í† ë¦¬ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.","info")):(B("GitHub ë ˆí¬ì§€í† ë¦¬ í˜ì´ì§€ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.","warning"),l&&(l.disabled=!0))})),l&&l.addEventListener("click",(async function(){try{if(!await o())throw new Error("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.");L(1,"in-progress","ë ˆí¬ì§€í† ë¦¬ ë¶„ì„ ì¤‘..."),x(1),r.style.display="block",l&&(l.disabled=!0),a.innerHTML="",s&&(s.style.display="none"),I(10);const e=await t("api/analyze-repo",{owner:n.repoOwner,repo:n.repoName});I(30),n.backgroundKnowledge=e.backgroundKnowledge,a.innerHTML=`\n        <h4>ë ˆí¬ì§€í† ë¦¬ ë¶„ì„ ê²°ê³¼</h4>\n        <div class="card mb-3">\n          <div class="card-body">\n            <h5 class="card-title">${e.repoInfo.name}</h5>\n            <h6 class="card-subtitle mb-2 text-muted">by ${e.repoInfo.owner}</h6>\n            <p class="card-text">${e.repoInfo.description||"ì„¤ëª… ì—†ìŒ"}</p>\n            <div class="mb-2">\n              <span class="badge bg-primary">${e.repoInfo.language||"Unknown"}</span>\n              <span class="badge bg-secondary">â­ ${e.repoInfo.stars}</span>\n              <span class="badge bg-secondary">ğŸ´ ${e.repoInfo.forks}</span>\n            </div>\n            <h6>í”„ë¡œì íŠ¸ ê°œìš”</h6>\n            <p>${e.backgroundKnowledge.projectOverview||"ì •ë³´ ì—†ìŒ"}</p>\n            <h6>ì£¼ìš” ê¸°ëŠ¥</h6>\n            <ul>\n              ${(e.backgroundKnowledge.keyFeatures||[]).map((e=>`<li>${e}</li>`)).join("")}\n            </ul>\n            <h6>ê¸°ìˆ  ìŠ¤íƒ</h6>\n            <div>\n              ${(e.backgroundKnowledge.techStack||[]).map((e=>`<span class="badge bg-info text-dark m-1">${e}</span>`)).join("")}\n            </div>\n          </div>\n        </div>\n      `,I(40),L(1,"completed","ë ˆí¬ì§€í† ë¦¬ ë¶„ì„ ì™„ë£Œ!"),L(2,"waiting"),x(2),l&&(l.disabled=!1)}catch(e){console.error("ë ˆí¬ì§€í† ë¦¬ ë¶„ì„ ì˜¤ë¥˜:",e),L(1,"error",`ì˜¤ë¥˜: ${e.message}`),l&&(l.disabled=!1)}finally{r.style.display="none"}})),d&&d.addEventListener("click",(async function(){try{if(!await o())throw new Error("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.");if(!$)return void B("ì‚¬ìš©ìëª… ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","warning");const e=$.value.trim();if(!e)return void B("GitHub ì‚¬ìš©ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.","warning");n.username=e,L(2,"in-progress","ì‚¬ìš©ì ê¸°ì—¬ ë¶„ì„ ì¤‘..."),r.style.display="block",d&&(d.disabled=!0),I(50);const s=await t("api/analyze-contributions",{owner:n.repoOwner,repo:n.repoName,username:e});I(70),n.contributionAnalysis=s.contributionAnalysis;const i=document.createElement("div");i.innerHTML=`\n        <h4>ì‚¬ìš©ì ê¸°ì—¬ ë¶„ì„</h4>\n        <div class="card mb-3">\n          <div class="card-body">\n            <h5 class="card-title">${e}ì˜ ê¸°ì—¬</h5>\n            \n            <h6>ì£¼ìš” ê¸°ì—¬ ì˜ì—­</h6>\n            <ul>\n              ${(s.contributionAnalysis.contributionAreas||[]).map((e=>`<li>${e}</li>`)).join("")}\n            </ul>\n            \n            <h6>ê¸°ìˆ ì  ì—­ëŸ‰</h6>\n            <div class="mb-2">\n              ${(s.contributionAnalysis.technicalSkills||[]).map((e=>`<span class="badge bg-success m-1">${e}</span>`)).join("")}\n            </div>\n            \n            <h6>ê¸°ì—¬ ìš”ì•½</h6>\n            <p>${s.contributionAnalysis.contributionSummary||"ì •ë³´ ì—†ìŒ"}</p>\n            \n            <h6>í•µì‹¬ ì½”ë“œ ë³€ê²½ì‚¬í•­</h6>\n            <ul>\n              ${(s.contributionAnalysis.keyCodeChanges||[]).map((e=>`<li>${e}</li>`)).join("")}\n            </ul>\n            \n            <h6>ì˜í–¥ë ¥ ë¶„ì„</h6>\n            <p>${s.contributionAnalysis.impactAnalysis||"ì •ë³´ ì—†ìŒ"}</p>\n          </div>\n        </div>\n      `,a.appendChild(i),I(80),L(2,"completed","ì‚¬ìš©ì ê¸°ì—¬ ë¶„ì„ ì™„ë£Œ!"),L(3,"waiting"),x(3),d&&(d.disabled=!1)}catch(e){console.error("ì‚¬ìš©ì ê¸°ì—¬ ë¶„ì„ ì˜¤ë¥˜:",e),L(2,"error",`ì˜¤ë¥˜: ${e.message}`),d&&(d.disabled=!1)}finally{r.style.display="none"}})),u&&u.addEventListener("click",(async function(){try{if(!await o())throw new Error("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.");if(!n.backgroundKnowledge)return B("ë¨¼ì € ë ˆí¬ì§€í† ë¦¬ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.","warning"),void x(1);if(!n.contributionAnalysis)return B("ë¨¼ì € ì‚¬ìš©ì ê¸°ì—¬ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.","warning"),void x(2);L(3,"in-progress","í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± ì¤‘..."),r.style.display="block",u&&(u.disabled=!0),a.innerHTML="",I(85);const e=await t("api/generate-portfolio",{backgroundKnowledge:n.backgroundKnowledge,contributionAnalysis:n.contributionAnalysis,username:n.username});I(95),n.portfolioHtml=e.html;const i=document.createElement("iframe");i.style.width="100%",i.style.height="400px",i.style.border="1px solid #ddd",i.style.borderRadius="5px",a.appendChild(i);const c=i.contentWindow.document;c.open(),c.write(e.html),c.close(),s&&(s.style.display="block"),I(100),L(3,"completed","í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± ì™„ë£Œ!"),u&&(u.disabled=!1)}catch(e){console.error("í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± ì˜¤ë¥˜:",e),L(3,"error",`ì˜¤ë¥˜: ${e.message}`),u&&(u.disabled=!1)}finally{r.style.display="none"}})),p&&p.addEventListener("click",(function(){n.portfolioHtml&&navigator.clipboard.writeText(n.portfolioHtml).then((()=>{p&&(p.textContent="ë³µì‚¬ë¨!",setTimeout((()=>{p.textContent="HTML ë³µì‚¬"}),2e3))})).catch((e=>{console.error("ë³µì‚¬ ì‹¤íŒ¨:",e),B("HTML ë³µì‚¬ ì‹¤íŒ¨","danger")}))})),m&&m.addEventListener("click",(function(){if(!n.portfolioHtml)return;const e=new Blob([n.portfolioHtml],{type:"text/html"}),t=URL.createObjectURL(e),o=document.createElement("a");o.href=t,o.download=`${n.repoName}-portfolio.html`,o.click(),URL.revokeObjectURL(t)})),g&&g.addEventListener("click",(function(){if(!n.portfolioHtml)return;const e=window.open("","_blank");e.document.write(n.portfolioHtml),e.document.close()})),v&&v.addEventListener("change",(function(){const e=v.value.match(/^https:\/\/github\.com\/([^\/]+)\/([^\/]+)(?:\/.*)?$/);e?(n.repoOwner=e[1],n.repoName=e[2],l&&(l.disabled=!1)):(B("ìœ íš¨í•œ GitHub ë ˆí¬ì§€í† ë¦¬ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.","warning"),l&&(l.disabled=!0))}))):console.error("í•„ìˆ˜ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. HTML íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.")}))})();